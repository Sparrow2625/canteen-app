<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Canteen Ordering System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .user-info h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .user-info p {
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn:hover {
            background: white;
            color: #f5576c;
        }

        .btn-primary {
            background: white;
            color: #f5576c;
        }

        .btn-primary:hover {
            background: rgba(255,255,255,0.9);
            transform: translateY(-2px);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .nav-tab:hover {
            background: rgba(240, 147, 251, 0.1);
        }

        .nav-tab.active {
            color: #f5576c;
            border-bottom-color: #f5576c;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .orders-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .order-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .order-card:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .order-info h3 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.3em;
        }

        .order-meta {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9em;
            flex-wrap: wrap;
        }

        .order-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-preparing {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #99d6ff;
        }

        .status-ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-completed {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .order-items {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .order-items h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .item-list {
            display: grid;
            gap: 8px;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .item-name {
            font-weight: 500;
        }

        .item-details {
            color: #666;
            font-size: 0.9em;
        }

        .order-total {
            font-weight: 700;
            font-size: 1.1em;
            color: #f5576c;
            text-align: right;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #e0e0e0;
        }

        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .btn-view {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
        }

        .btn-reorder {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
        }

        .offers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .offer-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .offer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        }

        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .offer-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-block;
        }

        .offer-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .offer-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .offer-validity {
            color: #999;
            font-size: 0.9em;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .timestamp {
            font-size: 0.8em;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: 1;
                min-width: 120px;
            }

            .tab-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .offers-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        .orders-container::-webkit-scrollbar {
            width: 8px;
        }

        .orders-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .orders-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
        }

        .orders-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #e04560 0%, #d04560 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="user-info">
                    <h1>Welcome, <span id="userName">User</span>!</h1>
                    <p>üì± <span id="userPhone"></span> | üÜî <span id="userStudentId"></span></p>
                </div>
                <div class="header-actions">
                    <a href="client.html" class="btn btn-primary">üçî Place New Order</a>
                    <a href="#" class="btn" onclick="logout()">üö™ Logout</a>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('overview')">üìä Overview</div>
            <div class="nav-tab" onclick="switchTab('current')">üîÑ Current Orders</div>
            <div class="nav-tab" onclick="switchTab('history')">üìú Order History</div>
            <div class="nav-tab" onclick="switchTab('offers')">üéâ Offers</div>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentOrders">0</div>
                    <div class="stat-label">Current Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedOrders">0</div>
                    <div class="stat-label">Completed Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSpent">$0</div>
                    <div class="stat-label">Total Spent</div>
                </div>
            </div>

            <h3 style="margin-bottom: 20px; color: #333;">üìà Recent Activity</h3>
            <div class="orders-container" id="recentOrders">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3>No recent orders</h3>
                    <p>Place your first order to see activity here</p>
                </div>
            </div>
        </div>

        <!-- Current Orders Tab -->
        <div class="tab-content" id="current">
            <h3 style="margin-bottom: 20px; color: #333;">üîÑ Active Orders</h3>
            <div class="orders-container" id="activeOrders">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3>No active orders</h3>
                    <p>Your current orders will appear here</p>
                </div>
            </div>
        </div>

        <!-- Order History Tab -->
        <div class="tab-content" id="history">
            <h3 style="margin-bottom: 20px; color: #333;">üìú Order History</h3>
            <div class="orders-container" id="pastOrders">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3>No past orders</h3>
                    <p>Your completed orders will appear here</p>
                </div>
            </div>
        </div>

        <!-- Offers Tab -->
        <div class="tab-content" id="offers">
            <h3 style="margin-bottom: 20px; color: #333;">üéâ Available Offers</h3>
            <div class="offers-grid">
                <div class="offer-card">
                    <div class="offer-badge">20% OFF</div>
                    <div class="offer-title">Combo Meal Deal</div>
                    <div class="offer-description">Get 20% off when you order any burger with fries and drink</div>
                    <div class="offer-validity">Valid until: Dec 31, 2025</div>
                </div>
                <div class="offer-card">
                    <div class="offer-badge">SPECIAL</div>
                    <div class="offer-title">Free Drink with Burger</div>
                    <div class="offer-description">Order any burger and get a free drink of your choice</div>
                    <div class="offer-validity">Valid every Monday</div>
                </div>
                <div class="offer-card">
                    <div class="offer-badge">15% OFF</div>
                    <div class="offer-title">Happy Hour</div>
                    <div class="offer-description">Get 15% off on all orders between 2 PM - 4 PM</div>
                    <div class="offer-validity">Weekdays only</div>
                </div>
                <div class="offer-card">
                    <div class="offer-badge">LOYALTY</div>
                    <div class="offer-title">5th Order Free</div>
                    <div class="offer-description">Your 5th order is on us! (Up to $10 value)</div>
                    <div class="offer-validity">Loyalty reward</div>
                </div>
                <div class="offer-card">
                    <div class="offer-badge">STUDENT</div>
                    <div class="offer-title">Student Special</div>
                    <div class="offer-description">Show your student ID and get 10% off</div>
                    <div class="offer-validity">Always valid</div>
                </div>
                <div class="offer-card">
                    <div class="offer-badge">WEEKEND</div>
                    <div class="offer-title">Weekend Feast</div>
                    <div class="offer-description">25% off on family meals (4+ items)</div>
                    <div class="offer-validity">Saturday & Sunday</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let allOrders = [];

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            // Load content for the tab
            if (tabName === 'overview') {
                loadOverview();
            } else if (tabName === 'current') {
                loadCurrentOrders();
            } else if (tabName === 'history') {
                loadOrderHistory();
            }
        }

        function loadUserData() {
            currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userPhone').textContent = currentUser.phone;
            document.getElementById('userStudentId').textContent = currentUser.studentId;
        }

        function loadAllOrders() {
            allOrders = JSON.parse(localStorage.getItem('canteenOrders') || '[]');
            // Filter orders for current user
            return allOrders.filter(order => order.studentId === currentUser.studentId);
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)} hours ago`;
            return date.toLocaleDateString();
        }

        function getStatusClass(status) {
            return `status-${status.toLowerCase().replace(/\s+/g, '-')}`;
        }

        function renderOrder(order, showActions = true) {
            const statusClass = getStatusClass(order.status);
            const itemsHTML = order.items.map(item => `
                <div class="item-row">
                    <span class="item-name">${item.item} x${item.quantity}</span>
                    <span class="item-details">$${item.total.toFixed(2)}</span>
                </div>
            `).join('');

            let actionsHTML = '';
            if (showActions) {
                if (order.status === 'Pending' && order.paymentMethod !== 'upi') {
                    actionsHTML = `
                        <div class="order-actions">
                            <button class="action-btn btn-cancel" onclick="cancelOrder('${order.orderId}')">
                                ‚ùå Cancel Order
                            </button>
                            <button class="action-btn btn-view" onclick="viewOrderDetails('${order.orderId}')">
                                üëÅÔ∏è View Details
                            </button>
                        </div>
                    `;
                } else if (order.status === 'Completed') {
                    actionsHTML = `
                        <div class="order-actions">
                            <button class="action-btn btn-reorder" onclick="reorderItems('${order.orderId}')">
                                üîÑ Reorder
                            </button>
                            <button class="action-btn btn-view" onclick="viewOrderDetails('${order.orderId}')">
                                üëÅÔ∏è View Details
                            </button>
                        </div>
                    `;
                } else {
                    actionsHTML = `
                        <div class="order-actions">
                            <button class="action-btn btn-view" onclick="viewOrderDetails('${order.orderId}')">
                                üëÅÔ∏è View Details
                            </button>
                        </div>
                    `;
                }
            }

            return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-info">
                            <h3>Order #${order.orderId}</h3>
                            <div class="order-meta">
                                <span class="timestamp">üïí ${formatTimestamp(order.timestamp)}</span>
                                <span>üí≥ ${order.paymentMethod === 'upi' ? 'UPI' : 'Cash'}</span>
                            </div>
                        </div>
                        <div class="order-status ${statusClass}">
                            ${order.status}
                        </div>
                    </div>

                    <div class="order-items">
                        <h4>Order Items:</h4>
                        <div class="item-list">
                            ${itemsHTML}
                        </div>
                        <div class="order-total">
                            Total: $${order.total.toFixed(2)}
                        </div>
                    </div>

                    ${actionsHTML}
                </div>
            `;
        }

        function loadOverview() {
            const userOrders = loadAllOrders();
            const currentOrders = userOrders.filter(order => 
                ['Pending', 'Preparing', 'Ready for Pickup'].includes(order.status)
            );
            const completedOrders = userOrders.filter(order => order.status === 'Completed');
            const totalSpent = userOrders.reduce((sum, order) => sum + order.total, 0);

            // Update stats
            document.getElementById('totalOrders').textContent = userOrders.length;
            document.getElementById('currentOrders').textContent = currentOrders.length;
            document.getElementById('completedOrders').textContent = completedOrders.length;
            document.getElementById('totalSpent').textContent = `$${totalSpent.toFixed(2)}`;

            // Show recent orders (last 5)
            const recentOrders = userOrders
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 5);

            const recentContainer = document.getElementById('recentOrders');
            if (recentOrders.length === 0) {
                recentContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No recent orders</h3>
                        <p>Place your first order to see activity here</p>
                    </div>
                `;
            } else {
                recentContainer.innerHTML = recentOrders.map(order => renderOrder(order, false)).join('');
            }
        }

        function loadCurrentOrders() {
            const userOrders = loadAllOrders();
            const currentOrders = userOrders.filter(order => 
                ['Pending', 'Preparing', 'Ready for Pickup'].includes(order.status)
            );

            const container = document.getElementById('activeOrders');
            if (currentOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No active orders</h3>
                        <p>Your current orders will appear here</p>
                    </div>
                `;
            } else {
                container.innerHTML = currentOrders.map(order => renderOrder(order, true)).join('');
            }
        }

        function loadOrderHistory() {
            const userOrders = loadAllOrders();
            const pastOrders = userOrders.filter(order => 
                ['Completed', 'Cancelled'].includes(order.status)
            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const container = document.getElementById('pastOrders');
            if (pastOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No past orders</h3>
                        <p>Your completed orders will appear here</p>
                    </div>
                `;
            } else {
                container.innerHTML = pastOrders.map(order => renderOrder(order, true)).join('');
            }
        }

        function cancelOrder(orderId) {
            if (!confirm('Are you sure you want to cancel this order?')) {
                return;
            }

            const allOrders = JSON.parse(localStorage.getItem('canteenOrders') || '[]');
            const orderIndex = allOrders.findIndex(order => order.orderId === orderId);
            
            if (orderIndex !== -1) {
                const order = allOrders[orderIndex];
                
                // Only allow cancellation for pending cash orders
                if (order.status !== 'Pending' || order.paymentMethod === 'upi') {
                    alert('This order cannot be cancelled. Only pending cash orders can be cancelled.');
                    return;
                }

                order.status = 'Cancelled';
                order.statusHistory.push({
                    status: 'Cancelled',
                    timestamp: new Date().toISOString(),
                    note: 'Order cancelled by user'
                });

                localStorage.setItem('canteenOrders', JSON.stringify(allOrders));
                
                // Refresh the current view
                loadCurrentOrders();
                loadOverview();
                
                alert('Order cancelled successfully!');
            }
        }

        function viewOrderDetails(orderId) {
            const allOrders = JSON.parse(localStorage.getItem('canteenOrders') || '[]');
            const order = allOrders.find(o => o.orderId === orderId);
            
            if (order) {
                let details = `Order #${order.orderId}\n\n`;
                details += `Status: ${order.status}\n`;
                details += `Payment: ${order.paymentMethod === 'upi' ? 'UPI' : 'Cash'}\n`;
                details += `Total: $${order.total.toFixed(2)}\n\n`;
                details += `Items:\n`;
                order.items.forEach(item => {
                    details += `- ${item.item} x${item.quantity} = $${item.total.toFixed(2)}\n`;
                });
                
                if (order.specialInstructions) {
                    details += `\nSpecial Instructions: ${order.specialInstructions}`;
                }
                
                alert(details);
            }
        }

        function reorderItems(orderId) {
            const allOrders = JSON.parse(localStorage.getItem('canteenOrders') || '[]');
            const order = allOrders.find(o => o.orderId === orderId);
            
            if (order) {
                // Store reorder data in localStorage for client.html to use
                localStorage.setItem('reorderData', JSON.stringify({
                    items: order.items,
                    specialInstructions: order.specialInstructions
                }));
                
                window.location.href = 'client.html';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            loadUserData();
            loadOverview();
        });

        // Auto-refresh every 30 seconds for current orders
        setInterval(() => {
            const activeTab = document.querySelector('.nav-tab.active').textContent.trim();
            if (activeTab.includes('Current')) {
                loadCurrentOrders();
            } else if (activeTab.includes('Overview')) {
                loadOverview();
            }
        }, 30000);
    </script>
</body>
</html>
